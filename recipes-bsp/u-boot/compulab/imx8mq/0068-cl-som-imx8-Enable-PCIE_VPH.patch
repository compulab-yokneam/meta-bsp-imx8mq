From 89f26927c70b1476743aa2a6dc4a4515e9c727d5 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Wed, 28 Jul 2021 15:51:48 +0300
Subject: [PATCH 68/68] cl-som-imx8: Enable PCIE_VPH

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 board/compulab/cl-som-imx8/cl-som-imx8.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/board/compulab/cl-som-imx8/cl-som-imx8.c b/board/compulab/cl-som-imx8/cl-som-imx8.c
index 46ae615023..cee654e780 100644
--- a/board/compulab/cl-som-imx8/cl-som-imx8.c
+++ b/board/compulab/cl-som-imx8/cl-som-imx8.c
@@ -341,6 +341,18 @@ static void setup_usbmux(void)
 	setup_iomux_usbmux();
 }
 
+static void setup_pcie_vph(void)
+{
+#define GPR_PCIE_VPH_EN BIT(12)
+	struct iomuxc_gpr_base_regs *gpr =
+		(struct iomuxc_gpr_base_regs *)IOMUXC_GPR_BASE_ADDR;
+
+	/* Enable Internale regulator */
+	clrbits_le32(&gpr->gpr[14], GPR_PCIE_VPH_EN);
+	clrbits_le32(&gpr->gpr[16], GPR_PCIE_VPH_EN);
+
+}
+
 int board_init(void)
 {
 
@@ -359,6 +371,8 @@ int board_init(void)
 #if defined(CONFIG_USB_DWC3) || defined(CONFIG_USB_XHCI_IMX8M)
 	init_usb_clk();
 #endif
+	setup_pcie_vph();
+
 	return 0;
 }
 
-- 
2.11.0

